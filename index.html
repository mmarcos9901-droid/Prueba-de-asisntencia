<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asistencia Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#020617,#1e293b);
      min-height:100vh;
      padding:20px;
      color:#0f172a;
    }
    .layout {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      max-width:900px;
      margin:auto;
    }
    .card {
      background:#fff;
      padding:20px;
      border-radius:16px;
      box-shadow:0 20px 40px rgba(0,0,0,.3);
    }
    h1,h2 { text-align:center; margin:0 0 10px 0; }
    .sub { text-align:center; font-size:14px; color:#475569; margin-bottom:10px; }
    input, button, select {
      width:100%; padding:10px; margin-top:8px; font-size:15px;
    }
    button { border:none; border-radius:8px; cursor:pointer; }
    .entrada{background:#22c55e;color:#fff;}
    .salida{background:#64748b;color:#fff;}
    .exportar{background:#0ea5e9;color:#fff;}
    .mes{margin-top:10px;background:#f8fafc;padding:10px;border-radius:10px;}
    .item{font-size:13px;border-bottom:1px dashed #cbd5f5;padding:4px 0;}
    .resumen{display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px;}
    .ok{color:#16a34a;} .alerta{color:#ea580c;}
    @media(max-width:800px){.layout{grid-template-columns:1fr;}}
  </style>
</head>
<body><div class="layout">  <!-- REGISTRO -->  <div class="card">
    <h1>üìã Asistencia Pro</h1>
    <div class="sub" id="mesActual"></div><input id="nombre" value="Marcos Mendez" />
<input id="horaEntrada" type="time" value="08:10" />
<input id="horaSalida" type="time" />

<button class="entrada" onclick="marcar('Entrada')">üü¢ Marcar Entrada</button>
<button class="salida" onclick="marcar('Salida')">‚ö™ Marcar Salida</button>

  </div>  <!-- VISTA / EXPORTACION -->  <div class="card" id="reporte">
    <h2>üëÄ Vista previa / Exportar</h2><select id="filtro" onchange="cargar()">
  <option value="mes">Mes actual</option>
  <option value="semana">Semana actual</option>
  <option value="todo">Todo</option>
</select>

<div id="resumen"></div>
<div id="log"></div>

<button class="exportar" onclick="exportarImagen()">üì∏ Exportar selecci√≥n</button>

  </div></div><script>
const logDiv = document.getElementById('log');
const resumenDiv = document.getElementById('resumen');
const mesActualDiv = document.getElementById('mesActual');

const ahora = new Date();
mesActualDiv.innerText = ahora.toLocaleDateString('es-CL',{month:'long',year:'numeric'});

function marcar(tipo){
  const data = JSON.parse(localStorage.getItem('asistencia'))||[];
  data.push({
    nombre:nombre.value,
    tipo,
    hora: tipo==='Entrada'?horaEntrada.value:horaSalida.value,
    fecha:new Date()
  });
  localStorage.setItem('asistencia',JSON.stringify(data));
  cargar();
}

function cargar(){
  const filtro = document.getElementById('filtro').value;
  const data = JSON.parse(localStorage.getItem('asistencia'))||[];
  logDiv.innerHTML=''; resumenDiv.innerHTML='';

  let registros = data;
  const hoy = new Date();

  if(filtro==='mes'){
    registros = data.filter(r=>{
      const d=new Date(r.fecha);
      return d.getMonth()===hoy.getMonth() && d.getFullYear()===hoy.getFullYear();
    });
  }

  if(filtro==='semana'){
    const inicio=new Date(hoy); inicio.setDate(hoy.getDate()-hoy.getDay());
    registros = data.filter(r=>new Date(r.fecha)>=inicio);
  }

  let dias=new Set(); let atrasos=0;
  registros.forEach(r=>{
    const d=new Date(r.fecha);
    dias.add(d.toDateString());
    if(r.tipo==='Entrada' && r.hora>'08:10') atrasos++;
    const div=document.createElement('div');
    div.className='item';
    div.innerText=`${d.toLocaleDateString()} ${r.hora||''} ‚Äî ${r.tipo}`;
    logDiv.appendChild(div);
  });

  resumenDiv.innerHTML=`
    <div class="resumen"><span>üìÖ D√≠as trabajados</span><strong>${dias.size}</strong></div>
    <div class="resumen"><span>‚ö†Ô∏è Atrasos</span><strong class="${atrasos? 'alerta':'ok'}">${atrasos}</strong></div>
  `;
}

function exportarImagen(){
  html2canvas(document.getElementById('reporte')).then(c=>{
    const a=document.createElement('a');
    a.download='asistencia.png';
    a.href=c.toDataURL();
    a.click();
  });
}

cargar();
</script></body>
</html>
