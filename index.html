<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asistencia Inteligente</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f3f4f6; padding:20px; }
    .card { background:#fff; padding:20px; border-radius:12px; max-width:480px; margin:auto; box-shadow:0 10px 25px rgba(0,0,0,.1);}    
    h1 { text-align:center; }
    input, button { width:100%; padding:10px; margin-top:8px; font-size:16px; }
    button { border:none; border-radius:6px; cursor:pointer; }
    .entrada { background:#22c55e; color:white; }
    .salida { background:#64748b; color:white; }
    .estado { margin-top:10px; font-size:14px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üìã Asistencia Inteligente</h1><label>Subir foto de la planilla</label>
<input type="file" id="imagen" accept="image/*" />

<label>Nombre</label>
<input id="nombre" value="MARCOS MENDEZ" />

<label>Ruta</label>
<input id="ruta" />

<label>And√©n</label>
<input id="anden" />

<label>Hora Entrada</label>
<input id="entrada" type="time" value="08:10" />

<label>Hora Salida</label>
<input id="salida" type="time" />

<button class="entrada" onclick="guardar('Entrada')">Guardar Entrada</button>
<button class="salida" onclick="guardar('Salida')">Guardar Salida</button>

<div class="estado" id="estado"></div>

  </div><script>
const estado = document.getElementById('estado');

imagen.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  estado.innerText = 'üîç Analizando imagen‚Ä¶';

  const result = await Tesseract.recognize(file, 'spa');
  const text = result.data.text.toUpperCase();

  // Buscar SOLO la fila donde aparece MARCOS MENDEZ
  const lineas = text.split('n');
  const miFila = lineas.find(l => l.includes('MARCOS') && l.includes('MENDEZ'));

  if (!miFila) {
    estado.innerText = '‚ùå No se encontr√≥ tu nombre en la imagen';
    return;
  }

  // Detectar ruta
  if (miFila.includes('SAN MIGUEL')) ruta.value = 'San Miguel';
  if (miFila.includes('LA FLORIDA')) ruta.value = 'La Florida';

  // Detectar and√©n
  const andenMatch = miFila.match(/(d+[A-Z]?)/);
  if (andenMatch) anden.value = andenMatch[1];

  estado.innerText = '‚úÖ Tu fila fue detectada autom√°ticamente';
});

function guardar(tipo) {
  const data = JSON.parse(localStorage.getItem('asistencia')) || [];
  data.unshift({
    nombre: nombre.value,
    ruta: ruta.value,
    anden: anden.value,
    tipo,
    entrada: entrada.value,
    salida: salida.value,
    fecha: new Date().toLocaleDateString()
  });
  localStorage.setItem('asistencia', JSON.stringify(data));
  alert('Registro guardado');
}
</script></body>
</html><!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asistencia Inteligente</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f3f4f6; padding:20px; }
    .card { background:#fff; padding:20px; border-radius:12px; max-width:480px; margin:auto; box-shadow:0 10px 25px rgba(0,0,0,.1);}    
    h1 { text-align:center; }
    input, button { width:100%; padding:10px; margin-top:8px; font-size:16px; }
    button { border:none; border-radius:6px; cursor:pointer; }
    .entrada { background:#22c55e; color:white; }
    .salida { background:#64748b; color:white; }
    .estado { margin-top:10px; font-size:14px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üìã Asistencia Inteligente</h1><label>Subir foto de la planilla</label>
<input type="file" id="imagen" accept="image/*" />

<label>Nombre</label>
<input id="nombre" value="MARCOS MENDEZ" />

<label>Ruta</label>
<input id="ruta" />

<label>And√©n</label>
<input id="anden" />

<label>Hora Entrada</label>
<input id="entrada" type="time" value="08:10" />

<label>Hora Salida</label>
<input id="salida" type="time" />

<button class="entrada" onclick="guardar('Entrada')">Guardar Entrada</button>
<button class="salida" onclick="guardar('Salida')">Guardar Salida</button>

<div class="estado" id="estado"></div>

  </div><script>
const estado = document.getElementById('estado');

imagen.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  estado.innerText = 'üîç Analizando imagen‚Ä¶';

  const result = await Tesseract.recognize(file, 'spa');
  const text = result.data.text.toUpperCase();

  // Buscar SOLO la fila donde aparece MARCOS MENDEZ
  const lineas = text.split('n');
  const miFila = lineas.find(l => l.includes('MARCOS') && l.includes('MENDEZ'));

  if (!miFila) {
    estado.innerText = '‚ùå No se encontr√≥ tu nombre en la imagen';
    return;
  }

  // Detectar ruta
  if (miFila.includes('SAN MIGUEL')) ruta.value = 'San Miguel';
  if (miFila.includes('LA FLORIDA')) ruta.value = 'La Florida';

  // Detectar and√©n
  const andenMatch = miFila.match(/(d+[A-Z]?)/);
  if (andenMatch) anden.value = andenMatch[1];

  estado.innerText = '‚úÖ Tu fila fue detectada autom√°ticamente';
});

function guardar(tipo) {
  const data = JSON.parse(localStorage.getItem('asistencia')) || [];
  data.unshift({
    nombre: nombre.value,
    ruta: ruta.value,
    anden: anden.value,
    tipo,
    entrada: entrada.value,
    salida: salida.value,
    fecha: new Date().toLocaleDateString()
  });
  localStorage.setItem('asistencia', JSON.stringify(data));
  alert('Registro guardado');
}
</script></body>
</html>
